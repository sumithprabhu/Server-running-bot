"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.historyCore = exports.history = void 0;
const tslib_1 = require("tslib");
const constants_1 = require("../constants");
const helpers_1 = require("../helpers");
const user_1 = require("../user");
const helpers_2 = require("./helpers");
var FetchLimit;
(function (FetchLimit) {
    FetchLimit[FetchLimit["MIN"] = 1] = "MIN";
    FetchLimit[FetchLimit["DEFAULT"] = 10] = "DEFAULT";
    FetchLimit[FetchLimit["MAX"] = 30] = "MAX";
})(FetchLimit || (FetchLimit = {}));
/**
 * Get all the messages exchanged between users after the threadhash.
 */
const history = (options) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
    return yield (0, exports.historyCore)(options, helpers_2.PGPHelper);
});
exports.history = history;
const historyCore = (options, pgpHelper) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
    const { threadhash, limit = FetchLimit.DEFAULT, pgpPrivateKey = '', account, toDecrypt = false, env = constants_1.default.ENV.PROD, } = options || {};
    try {
        if (limit < FetchLimit.MIN || limit > FetchLimit.MAX) {
            if (limit < FetchLimit.MIN)
                throw new Error(`Limit must be more than equal to ${FetchLimit.MIN}`);
            else
                throw new Error(`Limit must be less than equal to ${FetchLimit.MAX}`);
        }
        const messages = yield (0, helpers_2.getMessagesService)({ threadhash, limit, env });
        const updatedMessages = (0, helpers_2.addDeprecatedInfoToMessages)(messages);
        const connectedUser = yield (0, user_1.get)({ account: (0, helpers_1.pCAIP10ToWallet)(account), env });
        if (toDecrypt) {
            return yield (0, helpers_2.decryptConversation)({
                messages: updatedMessages,
                connectedUser,
                pgpPrivateKey,
                pgpHelper,
                env,
            });
        }
        return messages;
    }
    catch (err) {
        console.error(`[Push SDK] - API ${exports.history.name} -: `, err);
        throw Error(`[Push SDK] - API ${exports.history.name} -: ${err}`);
    }
});
exports.historyCore = historyCore;
//# sourceMappingURL=historicalMessages.js.map